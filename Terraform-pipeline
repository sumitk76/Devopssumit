pipeline {
    agent any

    stages {
        stage('Login to remote server Sumit') {
            steps {
               sh '''#!/bin/bash

# Define credentials
USER="sumit"
HOST="172.21.219.211"
PASSWORD="Rchik@6824"
PORT=22  # Optional

# Run SSH with password
sshpass -p "$PASSWORD" ssh -p $PORT $USER@$HOST'''
            }
        }

        stage('Checking directory to run terraform') {
            steps {
                sh '''
# Set your Terraform project directory
TF_DIR="/home/sumit/learn-terraform-get-started-aws"

# Move to the Terraform directory
cd "$TF_DIR" '''
            }
        }

        stage('Terraform- Ec2') {
            steps {
               sh '''# Initialize Terraform
terraform init

# Validate configuration
terraform validate

# Create an execution plan
#terraform plan -out=tfplan

# Apply the plan
#terraform apply tfplan
terraform apply

# Optional: Uncomment to destroy infrastructure
# terraform destroy -auto-approve'''
            }
        }
    }
}
